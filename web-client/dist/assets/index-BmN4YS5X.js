(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))g(p);new MutationObserver(p=>{for(const d of p)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&g(i)}).observe(document,{childList:!0,subtree:!0});function o(p){const d={};return p.integrity&&(d.integrity=p.integrity),p.referrerPolicy&&(d.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?d.credentials="include":p.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function g(p){if(p.ep)return;p.ep=!0;const d=o(p);fetch(p.href,d)}})();let l;const je=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&je.decode();let ce=null;function ee(){return(ce===null||ce.byteLength===0)&&(ce=new Uint8Array(l.memory.buffer)),ce}function Le(n,t){return n=n>>>0,je.decode(ee().subarray(n,n+t))}function pt(n,t){return n=n>>>0,ee().subarray(n/1,n/1+t)}function gt(n){const t=l.__externref_table_alloc();return l.__wbindgen_export_3.set(t,n),t}function _t(n,t){try{return n.apply(this,t)}catch(o){const g=gt(o);l.__wbindgen_exn_store(g)}}let le=0;const he=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},dt=typeof he.encodeInto=="function"?function(n,t){return he.encodeInto(n,t)}:function(n,t){const o=he.encode(n);return t.set(o),{read:n.length,written:o.length}};function ft(n,t,o){if(o===void 0){const h=he.encode(n),m=t(h.length,1)>>>0;return ee().subarray(m,m+h.length).set(h),le=h.length,m}let g=n.length,p=t(g,1)>>>0;const d=ee();let i=0;for(;i<g;i++){const h=n.charCodeAt(i);if(h>127)break;d[p+i]=h}if(i!==g){i!==0&&(n=n.slice(i)),p=o(p,g,g=i+n.length*3,1)>>>0;const h=ee().subarray(p+i,p+g),m=dt(n,h);i+=m.written,p=o(p,g,i,1)>>>0}return le=i,p}let O=null;function Ne(){return(O===null||O.buffer.detached===!0||O.buffer.detached===void 0&&O.buffer!==l.memory.buffer)&&(O=new DataView(l.memory.buffer)),O}function ht(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`)}function mt(n,t){const o=t(n.length*1,1)>>>0;return ee().set(n,o/1),le=n.length,o}const bt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>l.__wbg_lifeparams_free(n>>>0,1));class wt{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,bt.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_lifeparams_free(t,0)}get rule(){return l.__wbg_get_lifeparams_rule(this.__wbg_ptr)>>>0}set rule(t){l.__wbg_set_lifeparams_rule(this.__wbg_ptr,t)}get decay_step(){return l.__wbg_get_lifeparams_decay_step(this.__wbg_ptr)}set decay_step(t){l.__wbg_set_lifeparams_decay_step(this.__wbg_ptr,t)}get recovery_step(){return l.__wbg_get_lifeparams_recovery_step(this.__wbg_ptr)}set recovery_step(t){l.__wbg_set_lifeparams_recovery_step(this.__wbg_ptr,t)}get sat_recovery_factor(){return l.__wbg_get_lifeparams_sat_recovery_factor(this.__wbg_ptr)}set sat_recovery_factor(t){l.__wbg_set_lifeparams_sat_recovery_factor(this.__wbg_ptr,t)}get sat_decay_factor(){return l.__wbg_get_lifeparams_sat_decay_factor(this.__wbg_ptr)}set sat_decay_factor(t){l.__wbg_set_lifeparams_sat_decay_factor(this.__wbg_ptr,t)}get lum_decay_factor(){return l.__wbg_get_lifeparams_lum_decay_factor(this.__wbg_ptr)}set lum_decay_factor(t){l.__wbg_set_lifeparams_lum_decay_factor(this.__wbg_ptr,t)}get life_decay_factor(){return l.__wbg_get_lifeparams_life_decay_factor(this.__wbg_ptr)}set life_decay_factor(t){l.__wbg_set_lifeparams_life_decay_factor(this.__wbg_ptr,t)}get sat_ghost_factor(){return l.__wbg_get_lifeparams_sat_ghost_factor(this.__wbg_ptr)}set sat_ghost_factor(t){l.__wbg_set_lifeparams_sat_ghost_factor(this.__wbg_ptr,t)}get hue_drift_strength(){return l.__wbg_get_lifeparams_hue_drift_strength(this.__wbg_ptr)}set hue_drift_strength(t){l.__wbg_set_lifeparams_hue_drift_strength(this.__wbg_ptr,t)}get hue_lerp_factor(){return l.__wbg_get_lifeparams_hue_lerp_factor(this.__wbg_ptr)}set hue_lerp_factor(t){l.__wbg_set_lifeparams_hue_lerp_factor(this.__wbg_ptr,t)}}const Ie=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>l.__wbg_universe_free(n>>>0,1));class me{static __wrap(t){t=t>>>0;const o=Object.create(me.prototype);return o.__wbg_ptr=t,Ie.register(o,o.__wbg_ptr,o),o}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Ie.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_universe_free(t,0)}constructor(t,o){const g=l.universe_new(t,o);return this.__wbg_ptr=g>>>0,Ie.register(this,this.__wbg_ptr,this),this}static with_params(t,o,g){ht(g,wt);var p=g.__destroy_into_raw();const d=l.universe_with_params(t,o,p);return me.__wrap(d)}set_params(t,o,g,p,d,i,h,m,te,ue){l.universe_set_params(this.__wbg_ptr,t,o,g,p,d,i,h,m,te,ue)}index(t,o){return l.universe_index(this.__wbg_ptr,t,o)>>>0}set_grid(t,o,g,p){l.universe_set_grid(this.__wbg_ptr,t,o,g,p)}randomize(){l.universe_randomize(this.__wbg_ptr)}clear(){l.universe_clear(this.__wbg_ptr)}draw_stamp_at(t,o,g,p,d){const i=mt(d,l.__wbindgen_malloc),h=le;l.universe_draw_stamp_at(this.__wbg_ptr,t,o,g,p,i,h)}draw_brush(t,o,g,p,d,i,h){l.universe_draw_brush(this.__wbg_ptr,t,o,g,p,d,i,h)}tick(){l.universe_tick(this.__wbg_ptr)}resize(t,o){l.universe_resize(this.__wbg_ptr,t,o)}set_cell(t,o,g,p,d,i){l.universe_set_cell(this.__wbg_ptr,t,o,g,p,d,i)}cells_ptr(){return l.universe_cells_ptr(this.__wbg_ptr)>>>0}cells_len(){return l.universe_cells_len(this.__wbg_ptr)>>>0}width(){return l.universe_width(this.__wbg_ptr)>>>0}height(){return l.universe_height(this.__wbg_ptr)>>>0}toggle(t,o){l.universe_toggle(this.__wbg_ptr,t,o)}}async function yt(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(g){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",g);else throw g}const o=await n.arrayBuffer();return await WebAssembly.instantiate(o,t)}else{const o=await WebAssembly.instantiate(n,t);return o instanceof WebAssembly.Instance?{instance:o,module:n}:o}}function vt(){const n={};return n.wbg={},n.wbg.__wbg_debug_e17b51583ca6a632=function(t,o,g,p){console.debug(t,o,g,p)},n.wbg.__wbg_error_524f506f44df1645=function(t){console.error(t)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,o){let g,p;try{g=t,p=o,console.error(Le(t,o))}finally{l.__wbindgen_free(g,p,1)}},n.wbg.__wbg_error_80de38b3f7cc3c3c=function(t,o,g,p){console.error(t,o,g,p)},n.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return _t(function(t,o){globalThis.crypto.getRandomValues(pt(t,o))},arguments)},n.wbg.__wbg_info_033d8b8a0838f1d3=function(t,o,g,p){console.info(t,o,g,p)},n.wbg.__wbg_log_cad59bb680daec67=function(t,o,g,p){console.log(t,o,g,p)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,o){const g=o.stack,p=ft(g,l.__wbindgen_malloc,l.__wbindgen_realloc),d=le;Ne().setInt32(t+4*1,d,!0),Ne().setInt32(t+4*0,p,!0)},n.wbg.__wbg_warn_aaf1f4664a035bd6=function(t,o,g,p){console.warn(t,o,g,p)},n.wbg.__wbindgen_init_externref_table=function(){const t=l.__wbindgen_export_3,o=t.grow(4);t.set(0,void 0),t.set(o+0,void 0),t.set(o+1,null),t.set(o+2,!0),t.set(o+3,!1)},n.wbg.__wbindgen_string_new=function(t,o){return Le(t,o)},n.wbg.__wbindgen_throw=function(t,o){throw new Error(Le(t,o))},n}function xt(n,t){return l=n.exports,Ye.__wbindgen_wasm_module=t,O=null,ce=null,l.__wbindgen_start(),l}async function Ye(n){if(l!==void 0)return l;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/rca/assets/ca_bg-BJwQZtZ6.wasm",import.meta.url));const t=vt();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:o,module:g}=await yt(await n,t);return xt(o,g)}(async()=>{const n={x:0,y:0},t=window.devicePixelRatio||1,g=(await Ye()).memory,p=Math.floor(window.innerWidth),d=Math.floor(window.innerHeight),i=new me(p,d);i.randomize();let h,m=null,te="stretch",ue,Ae=0,be=0,we=!1,ye=!1,pe=!1,ve=4294967295,W="#2F3E4E",xe=.1,Fe=.1,A="#2F3E4E",De="#FF0000",R=H(0,ve),X=Math.random()>.5?1:H(0,500),G=H(0,500),N=.8,j=.5,Y=.95,q=.95,V=.9,Z=.1,J=.1,re=.1,ne=.1,ae=.1,ge=40,Ee="brush",oe=null,Me=!1,Ce=0,ke=0,K=!1,_e=!1,Se=0,Te=255,$e=127;const E=document.createElement("canvas"),S=document.createElement("div"),He=document.createElement("div"),Re=document.createElement("div");S.className="panel",window.addEventListener("keydown",e=>{switch(e.key){case"ArrowUp":e.preventDefault(),R+=1,document.getElementById("rule_input").value=R;break;case"ArrowDown":e.preventDefault(),R-=1,document.getElementById("rule_input").value=R;break;case"c":i.clear();break;case"b":se();break;case"a":i.randomize();break;case"r":Ue();break;case"h":S.style.display=S.style.display==="none"?"block":"none";break;case"p":K=!K,K||B();break;case"s":B();break;default:return}});function de(){const e=xe*window.innerWidth,s=Fe*window.innerHeight,r=e/2,c=s/2,a=Math.min(e,s)*.1;h={circle:`<svg width="${e}" height="${s}" xmlns="http://www.w3.org/2000/svg">
        <circle cx="${r}" cy="${c}" r="${a/2}" fill="${W}"/>
      </svg>`,square:`<svg width="${e}" height="${s}" xmlns="http://www.w3.org/2000/svg">
        <rect x="${r-a/2}" y="${c-a/2}" width="${a}" height="${a}" fill="${W}"/>
      </svg>`,triangle:`<svg width="${e}" height="${s}" xmlns="http://www.w3.org/2000/svg">
        <polygon fill="${W}" points="
          ${r},${c-a/2}
          ${r+a/2},${c+a/2}
          ${r-a/2},${c+a/2}
        "/>
      </svg>`,star:`<svg width="${e}" height="${s}" xmlns="http://www.w3.org/2000/svg">
        <polygon fill="${W}" points="
          ${r},${c-a*.5}
          ${r+a*.11},${c-a*.15}
          ${r+a*.38},${c-a*.15}
          ${r+a*.16},${c+a*.07}
          ${r+a*.24},${c+a*.34}
          ${r},${c+a*.18}
          ${r-a*.24},${c+a*.34}
          ${r-a*.16},${c+a*.07}
          ${r-a*.38},${c-a*.15}
          ${r-a*.11},${c-a*.15}
        "/>
      </svg>`,hexagon:`<svg width="${e}" height="${s}" xmlns="http://www.w3.org/2000/svg">
        <polygon fill="${W}" points="
          ${r},${c-a*.5}
          ${r+a*.433},${c-a*.25}
          ${r+a*.433},${c+a*.25}
          ${r},${c+a*.5}
          ${r-a*.433},${c+a*.25}
          ${r-a*.433},${c-a*.25}
        "/>
      </svg>`}}de();let _={rule:{tag:"input",props:{id:"rule_input",type:"number",value:R,oninput:e=>{R=parseInt(e.target.value)}}},randomize:{tag:"button",innerHTML:"Randomize",props:{onclick:Ue}},shapeColor:{tag:"input",props:{type:"color",oninput:e=>{W=e.target.value,de()},value:A}},shapeSizeX:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:xe,oninput:e=>{xe=parseFloat(e.target.value),de()}}},shapeSizeY:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:Fe,oninput:e=>{Fe=parseFloat(e.target.value),de()}}},brushColor:{tag:"input",props:{type:"color",oninput:et,value:De}},backgroundColor:{tag:"input",props:{type:"color",oninput:e=>{A=e.target.value,document.body.style.backgroundColor=A},value:A}},brushSize:{tag:"input",props:{type:"range",min:1,max:200,value:ge,oninput:e=>{ge=parseInt(e.target.value),F()}}},pause:{tag:"input",props:{type:"checkbox",onclick:e=>{K=e.target.checked,K||B()}}},clear:{tag:"button",innerHTML:"Clear",props:{onclick:()=>{i.clear(),F()}}},setColor:{tag:"button",innerHTML:"Set",props:{onclick:()=>{i.set_grid(Se,Te,$e),F()}}},decaySlider:{tag:"input",props:{type:"range",min:1,max:500,value:X,oninput:e=>{X=parseInt(e.target.value),F()}}},recoverySlider:{tag:"input",props:{type:"range",min:1,max:500,value:G,oninput:e=>{G=parseInt(e.target.value),F()}}},satRecoveryFactor:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:N,oninput:e=>{N=parseFloat(e.target.value),F()}}},satDecayFactor:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:j,oninput:e=>{j=parseFloat(e.target.value),F()}}},lumDecayFactor:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:Y,oninput:e=>{Y=parseFloat(e.target.value),F()}}},lifeDecayFactor:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:q,oninput:e=>{q=parseFloat(e.target.value),F()}}},satGhostFactor:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:V,oninput:e=>{V=parseFloat(e.target.value),F()}}},bgHueAmplitude:{tag:"input",props:{type:"range",min:0,max:2,step:.01,value:re,oninput:e=>{re=parseFloat(e.target.value),F()}}},bgSatAmplitude:{tag:"input",props:{type:"range",min:0,max:2,step:.01,value:ne,oninput:e=>{ne=parseFloat(e.target.value),F()}}},hueDriftStrength:{tag:"input",props:{type:"range",min:0,max:.2,step:.001,value:Z,oninput:e=>{Z=parseFloat(e.target.value),F()}}},hueLerpFactor:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:J,oninput:e=>{J=parseFloat(e.target.value),F()}}},ruleChangeRate:{tag:"input",props:{type:"range",min:0,max:1,step:.01,value:ae,oninput:e=>{ae=parseFloat(e.target.value),F()}}},autoRotate:{tag:"input",props:{type:"checkbox",onclick:e=>{ye=e.target.checked,ye||B()}}},rotateHue:{tag:"input",props:{type:"checkbox",onclick:e=>{we=e.target.checked,we||B()}}},stampOnRotate:{tag:"input",props:{type:"checkbox",onclick:e=>{pe=e.target.checked,pe||B()}}},brushImageUpload:{tag:"input",props:{type:"file",accept:"image/*",onchange:Je}},brushMode:{tag:"select",props:{onchange:e=>{Ee=e.target.value}},children:[{tag:"option",props:{value:"brush"},innerHTML:"Brush"},{tag:"option",props:{value:"stamp"},innerHTML:"Stamp"}]},builtInImages:{tag:"select",props:{onchange:Be},children:[{tag:"option",props:{value:null},innerHTML:"None"},{tag:"option",props:{value:h.circle},innerHTML:"Circle Shape"},{tag:"option",props:{value:h.square},innerHTML:"Square Shape"},{tag:"option",props:{value:h.triangle},innerHTML:"Triangle Shape"},{tag:"option",props:{value:h.hexagon},innerHTML:"Hexagon Shape"}]},imageUpload:{tag:"input",props:{type:"file",accept:"image/*",onchange:Ve}},backgroundModeSelect:{tag:"select",props:{onchange:Ze},children:[{tag:"option",props:{value:"stretch"},innerHTML:"Stretch"},{tag:"option",props:{value:"full"},innerHTML:"Full"},{tag:"option",props:{value:"repeat"},innerHTML:"Repeat"},{tag:"option",props:{value:"center"},innerHTML:"Center"}]},setBackgroundButton:{tag:"button",props:{onclick:se},innerHTML:"Set Image"}};function Be(e){const s=e.target?e.target.value:e;if(!s)return;const r=new Image;r.onload=()=>{m=r,se()},r.src="data:image/svg+xml;utf8,"+encodeURIComponent(s)}function qe(){const e=Math.floor(Math.random()*256).toString(16).padStart(2,"0"),s=Math.floor(Math.random()*256).toString(16).padStart(2,"0"),r=Math.floor(Math.random()*256).toString(16).padStart(2,"0");return`#${e}${s}${r}`}function Ue(){if(i.clear(),pe){var e=Object.keys(h),s=e[H(0,e.length-1)];Be(h[s])}A=qe(),document.getElementById("backgroundColor").value=A,document.body.style.backgroundColor=A,De="#FF0000",R=H(parseInt(_.rule.props.min??0),parseInt(_.rule.props.max??ve)),document.getElementById("rule_input").value=R,X=Math.random()>.5?1:H(0,500),document.getElementById("decaySlider").value=X,G=H(parseInt(_.recoverySlider.props.min),parseInt(_.recoverySlider.props.max)),document.getElementById("recoverySlider").value=G,N=parseFloat((Math.random()*(_.satRecoveryFactor.props.max-_.satRecoveryFactor.props.min)+parseFloat(_.satRecoveryFactor.props.min)).toFixed(2)),document.getElementById("satRecoveryFactor").value=N,j=parseFloat((Math.random()*(_.satDecayFactor.props.max-_.satDecayFactor.props.min)+parseFloat(_.satDecayFactor.props.min)).toFixed(2)),document.getElementById("satDecayFactor").value=j,Y=parseFloat((Math.random()*(_.lumDecayFactor.props.max-_.lumDecayFactor.props.min)+parseFloat(_.lumDecayFactor.props.min)).toFixed(2)),document.getElementById("lumDecayFactor").value=Y,q=parseFloat((Math.random()*(_.lifeDecayFactor.props.max-_.lifeDecayFactor.props.min)+parseFloat(_.lifeDecayFactor.props.min)).toFixed(2)),document.getElementById("lifeDecayFactor").value=q,V=parseFloat((Math.random()*(_.satGhostFactor.props.max-_.satGhostFactor.props.min)+parseFloat(_.satGhostFactor.props.min)).toFixed(2)),document.getElementById("satGhostFactor").value=V,Z=parseFloat((Math.random()*(_.hueDriftStrength.props.max-_.hueDriftStrength.props.min)+parseFloat(_.hueDriftStrength.props.min)).toFixed(3)),document.getElementById("hueDriftStrength").value=Z,J=parseFloat((Math.random()*(_.hueLerpFactor.props.max-_.hueLerpFactor.props.min)+parseFloat(_.hueLerpFactor.props.min)).toFixed(2)),document.getElementById("hueLerpFactor").value=J,re=parseFloat((Math.random()*(_.bgHueAmplitude.props.max-_.bgHueAmplitude.props.min)+parseFloat(_.bgHueAmplitude.props.min)).toFixed(2)),document.getElementById("bgHueAmplitude").value=re,ne=parseFloat((Math.random()*(_.bgSatAmplitude.props.max-_.bgSatAmplitude.props.min)+parseFloat(_.bgSatAmplitude.props.min)).toFixed(2)),document.getElementById("bgSatAmplitude").value=ne,ae=parseFloat((Math.random()*(_.ruleChangeRate.props.max-_.ruleChangeRate.props.min)+parseFloat(_.ruleChangeRate.props.min)).toFixed(2)),document.getElementById("ruleChangeRate").value=ae,i.clear(),m?se():i.randomize(),F()}ue=Ke(_),Object.values(ue).forEach(e=>{S.appendChild(e)}),S.appendChild(He),S.appendChild(Re);function Ve(e){const s=e.target.files[0];if(!s)return;const r=new FileReader;r.onload=()=>{const c=new Image;c.onload=()=>{m=c},c.src=r.result},r.readAsDataURL(s)}function Ze(e){te=e.target.value}function se(){if(!m){alert("Please upload a background image first.");return}const e=i.width(),s=i.height(),r=document.createElement("canvas"),c=r.getContext("2d");let a,f,b=0,v=0;switch(te){case"stretch":a=e,f=s,r.width=a,r.height=f,c.drawImage(m,0,0,a,f);break;case"full":{const fe=Math.max(e/m.width,s/m.height);a=m.width*fe,f=m.height*fe,b=(e-a)/2,v=(s-f)/2,r.width=e,r.height=s,c.clearRect(0,0,r.width,r.height),c.drawImage(m,b,v,a,f);break}case"center":a=m.width,f=m.height,r.width=a,r.height=f,c.drawImage(m,0,0),b=(e-a)/2,v=(s-f)/2;break;case"repeat":r.width=e,r.height=s;const z=c.createPattern(m,"repeat");c.fillStyle=z,c.fillRect(0,0,e,s),a=e,f=s;break;default:console.warn("Unknown background mode:",te);return}const M=c.getImageData(0,0,r.width,r.height),I=new Uint8Array(M.data.buffer),ie=Math.floor((b||0)+a/2),U=Math.floor((v||0)+f/2);i.draw_stamp_at(ie,U,M.width,M.height,I)}function Je(e){const s=e.target.files[0];if(!s)return;const r=new Image;r.onload=()=>{const c=document.createElement("canvas");c.width=r.width,c.height=r.height;const a=c.getContext("2d");a.drawImage(r,0,0),oe=a.getImageData(0,0,r.width,r.height),console.log(`Loaded stamp image: ${r.width}×${r.height}`)},r.src=URL.createObjectURL(s)}function F(){He.innerHTML=`
      Brush: ${ge}<br>
      Rule: ${R}<br>
      Decay Step: ${X}, Recovery Step: ${G}<br>
      Sat Recovery: ${N.toFixed(2)}, Sat Decay: ${j.toFixed(2)}<br>
      Lum Decay: ${Y.toFixed(2)}, Life Decay: ${q.toFixed(2)}, Sat Ghost: ${V.toFixed(2)}<br>
      Hue Drift: ${Z.toFixed(3)}, Hue Lerp: ${J.toFixed(2)}
    `}function ze(e){if(!e){const f=i.cells_ptr(),b=i.cells_len();e=new Uint8Array(g.buffer,f,b)}const s=n.x,r=n.y;if(s>=i.width()||r>=i.height()){Re.innerHTML="I: out of bounds";return}const a=i.index(r,s)*3;Re.innerHTML=`I: H:${e[a]} S:${e[a+1]} L:${e[a+2]}`}function Ke(e){const s={};for(const[r,c]of Object.entries(e)){const a=document.createElement("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="0.5em";const f=document.createElement("label");f.textContent=r.replace(/([A-Z])/g," $1").replace(/^./,v=>v.toUpperCase());const b=document.createElement(c.tag);if(b.id=r,c.innerHTML&&(b.innerHTML=c.innerHTML),c.props)for(const[v,M]of Object.entries(c.props))b[v]=M;if(Array.isArray(c.children))for(const v of c.children){const M=document.createElement(v.tag);if(v.innerHTML&&(M.innerHTML=v.innerHTML),v.props)for(const[I,ie]of Object.entries(v.props))M[I]=ie;b.appendChild(M)}a.appendChild(f),a.appendChild(b),s[r]=a}return s}function Qe(e,s,r=30,c=20){function a(w){w=w.replace(/^#/,""),w.length===3&&(w=w.split("").map(y=>y+y).join(""));const x=parseInt(w,16);return{r:x>>16&255,g:x>>8&255,b:x&255}}function f(w,x,y){w/=255,x/=255,y/=255;const L=Math.max(w,x,y),C=Math.min(w,x,y);let D,P,T=(L+C)/2;if(L===C)D=P=0;else{const $=L-C;switch(P=T>.5?$/(2-L-C):$/(L+C),L){case w:D=(x-y)/$+(x<y?6:0);break;case x:D=(y-w)/$+2;break;case y:D=(w-x)/$+4;break}D/=6}return{h:D*360,s:P*100,l:T*100}}function b(w,x,y){w/=360,x/=100,y/=100;const L=(T,$,k)=>(k<0&&(k+=1),k>1&&(k-=1),k<1/6?T+($-T)*6*k:k<1/2?$:k<2/3?T+($-T)*(2/3-k)*6:T);let C,D,P;if(x===0)C=D=P=y;else{const T=y<.5?y*(1+x):y+x-y*x,$=2*y-T;C=L($,T,w+1/3),D=L($,T,w),P=L($,T,w-1/3)}return{r:Math.round(C*255),g:Math.round(D*255),b:Math.round(P*255)}}function v(w,x,y){return"#"+[w,x,y].map(L=>L.toString(16).padStart(2,"0")).join("")}const{r:M,g:I,b:ie}=a(e);let{h:U,s:z,l:fe}=f(M,I,ie);const Ge=Math.sin(s);U=(U+r*Ge)%360,U<0&&(U+=360),z=z+c*Ge,z=Math.max(0,Math.min(100,z));const{r:ct,g:lt,b:ut}=b(U,z,fe);return v(ct,lt,ut)}document.querySelector("#app").appendChild(E),document.querySelector("#app").appendChild(S),S.addEventListener("mousedown",e=>{e.target===S&&(Me=!0,Ce=e.clientX-S.offsetLeft,ke=e.clientY-S.offsetTop,e.preventDefault())}),document.addEventListener("mousemove",e=>{Me&&(S.style.left=`${e.clientX-Ce}px`,S.style.top=`${e.clientY-ke}px`)}),document.addEventListener("mouseup",()=>{Me=!1});function et(e){const s=tt(e.srcElement.value);console.log(s),Se=s.h,Te=s.s,$e=s.l}function tt(e){e=e.replace("#","");let s=parseInt(e.length===3?e[0]+e[0]:e.substring(0,2),16)/255,r=parseInt(e.length===3?e[1]+e[1]:e.substring(2,4),16)/255,c=parseInt(e.length===3?e[2]+e[2]:e.substring(4,6),16)/255;const a=Math.max(s,r,c),f=Math.min(s,r,c);let b=0,v=0;const M=(a+f)/2;if(a!==f){const I=a-f;switch(v=M>.5?I/(2-a-f):I/(a+f),a){case s:b=(r-c)/I+(r<c?6:0);break;case r:b=(c-s)/I+2;break;case c:b=(s-r)/I+4;break}b/=6}return{h:Math.round(b*255),s:Math.round(v*255),l:Math.round(M*255)}}function Pe(){E.width=i.width()*t,E.height=i.height()*t,E.style.width=`${i.width()}px`,E.style.height=`${i.height()}px`}Pe();const u=E.getContext("webgl");if(!u)throw new Error("WebGL not supported");function rt(e){const s=E.getBoundingClientRect(),r=E.width/s.width,c=E.height/s.height;n.x=Math.floor((e.clientX-s.left)*r/t),n.y=Math.floor((e.clientY-s.top)*c/t),ze()}function H(e,s){return e=Math.ceil(e),s=Math.floor(s),Math.floor(Math.random()*(s-e+1)+e)}function Oe(){const{x:e,y:s}=n;if(Ee==="stamp"){if(!oe)return;const r=oe.width,c=oe.height,a=oe.data;i.draw_stamp_at(e,s,r,c,a)}Ee==="brush"&&i.draw_brush(e,s,ge,!0,Se,Te,$e)}E.addEventListener("mousedown",e=>{e.preventDefault(),e.button,_e=!0,Oe()}),E.addEventListener("mouseup",()=>_e=!1),E.addEventListener("mouseleave",()=>_e=!1),E.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("mousemove",rt),window.addEventListener("resize",()=>{const e=Math.floor(window.innerWidth),s=Math.floor(window.innerHeight);(e>i.width()||s>i.height())&&(i.resize(Math.max(e,i.width()),Math.max(s,i.height())),Pe())});const nt=`
attribute vec2 a_position;
varying vec2 v_texcoord;
void main() {
  v_texcoord = a_position * 0.5 + 0.5;
  gl_Position = vec4(a_position, 0.0, 1.0);
}`,at=`
precision mediump float;

uniform sampler2D u_texture;
varying vec2 v_texcoord;


float hue2rgb(float f1, float f2, float hue) {
    if (hue < 0.0)
        hue += 1.0;
    else if (hue > 1.0)
        hue -= 1.0;
    float res;
    if ((6.0 * hue) < 1.0)
        res = f1 + (f2 - f1) * 6.0 * hue;
    else if ((2.0 * hue) < 1.0)
        res = f2;
    else if ((3.0 * hue) < 2.0)
        res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
    else
        res = f1;
    return res;
}

vec3 hsl2rgb(vec3 hsl) {
    vec3 rgb;
    
    if (hsl.y == 0.0) {
        rgb = vec3(hsl.z); // Luminance
    } else {
        float f2;
        
        if (hsl.z < 0.5)
            f2 = hsl.z * (1.0 + hsl.y);
        else
            f2 = hsl.z + hsl.y - hsl.y * hsl.z;
            
        float f1 = 2.0 * hsl.z - f2;
        
        rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
        rgb.g = hue2rgb(f1, f2, hsl.x);
        rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));
    }   
    return rgb;
}
void main() {
  vec4 hsl = texture2D(u_texture, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgba;

  float hue = hsl.r;
  float sat = hsl.g;
  float lum = hsl.b;

  vec3 rgb = hsl2rgb(vec3(hue, sat, lum)); 

  gl_FragColor = vec4(rgb, hsl.a);
}`;function We(e,s){const r=u.createShader(e);if(u.shaderSource(r,s),u.compileShader(r),!u.getShaderParameter(r,u.COMPILE_STATUS))throw new Error(u.getShaderInfoLog(r));return r}const Q=u.createProgram();u.attachShader(Q,We(u.VERTEX_SHADER,nt)),u.attachShader(Q,We(u.FRAGMENT_SHADER,at)),u.linkProgram(Q),u.useProgram(Q);const Xe=u.getAttribLocation(Q,"a_position"),ot=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,ot),u.bufferData(u.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),u.STATIC_DRAW),u.enableVertexAttribArray(Xe),u.vertexAttribPointer(Xe,2,u.FLOAT,!1,0,0);const st=u.createTexture();u.bindTexture(u.TEXTURE_2D,st),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.pixelStorei(u.UNPACK_ALIGNMENT,1);const it=u.getUniformLocation(Q,"u_texture");u.uniform1i(it,0);function B(){Ae+=.01,_e&&Oe(),be+=ae,we&&(A=Qe(A,Ae,re,ne),document.body.style.backgroundColor=A),ye&&(be>100&&(R=H(0,ve),document.getElementById("rule_input").value=R,be=0),pe&&(i.clear(),m?se():i.randomize())),i.set_params(R,X,G,N,j,Y,q,V,Z,J),i.tick();const e=i.cells_ptr(),s=i.cells_len(),r=new Uint8Array(g.buffer,e,s);u.texImage2D(u.TEXTURE_2D,0,u.RGBA,i.width(),i.height(),0,u.RGBA,u.UNSIGNED_BYTE,r),u.viewport(0,0,E.width,E.height),u.drawArrays(u.TRIANGLES,0,6),ze(r),K||requestAnimationFrame(B)}F(),B()})();
